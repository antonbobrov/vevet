"use strict";(self.webpackChunkvevet=self.webpackChunkvevet||[]).push([[53],{"./src/components/SmoothScrollDragPlugin/stories/index.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>index_stories});var react=__webpack_require__("./node_modules/react/index.js"),Plugin=__webpack_require__("./src/base/Plugin/index.ts"),DraggerMove=__webpack_require__("./src/components/DraggerMove/index.ts");class SmoothScrollDragPlugin extends Plugin.S{_getDefaultProps(){return{...super._getDefaultProps(),isEnabled:!0,speed:1,lerp:!1,stopPropagationThreshold:!1,stopPropagationDirection:"y"}}get isDragging(){return this._dragger?.isDragging??!1}_init(){super._init(),this._toggleDragger()}_onPropsMutate(){super._onPropsMutate(),this._toggleDragger()}_toggleDragger(){this.props.isEnabled?this._addDragger():this._removeDragger()}_addDragger(){if(this._dragger)return;const{component}=this;this._dragger=new DraggerMove.J({container:component.container}),this._dragger.addCallback("start",(()=>this._handleDragStart())),this._dragger.addCallback("move",(data=>this._handleDragMove(data))),this._dragger.addCallback("end",(()=>this._handleDragEnd())),this._componentCallbacks||(this._componentCallbacks=[]),this._componentCallbacks.push(component.addCallback("wheel",(()=>this._dragger?.cancel()),{name:this.name}))}_removeDragger(){this._dragger&&(this._dragger.destroy(),this._dragger=void 0,this._componentCallbacks?.forEach((callback=>callback.remove())),this._componentCallbacks=[])}_getIsDragAvailable(){const{component}=this;return!!component.props.isEnabled&&!(component.maxScrollableWidth<=0&&component.maxScrollableHeight<=0)}_handleDragStart(){if(!this._getIsDragAvailable())return;const{component}=this;"number"==typeof this.props.lerp&&(this._prevComponentLerp=component.props.lerp,component.changeProps({lerp:this.props.lerp})),this.callbacks.tbt("start",void 0)}_handleDragMove({event,coords,start,step}){if(!this._getIsDragAvailable())return;const{component}=this,{props}=this,{stopPropagationThreshold:threshold,stopPropagationDirection:direction}=this.props;if("number"==typeof threshold&&event.cancelable){const diffX=Math.abs(coords.x-start.x),diffY=Math.abs(coords.y-start.y);(diffX>threshold&&"x"===direction||diffY>threshold&&"y"===direction)&&(event.preventDefault(),event.stopPropagation())}const x=step.x*props.speed,y=step.y*props.speed;component.targetLeft-=x,component.targetTop-=y,component.wrapper.style.pointerEvents="none",component.wrapper.style.userSelect="none",this.callbacks.tbt("move",void 0)}_handleDragEnd(){const{component}=this;component.wrapper.style.pointerEvents="",component.wrapper.style.userSelect="","number"==typeof this._prevComponentLerp&&(component.changeProps({lerp:this._prevComponentLerp}),this._prevComponentLerp=void 0),this.callbacks.tbt("end",void 0)}_destroy(){super._destroy(),this._removeDragger()}}var SmoothScroll=__webpack_require__("./src/components/SmoothScroll/index.ts"),times=__webpack_require__("./src/utils/common/times.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const Component=()=>{const containerRef=(0,react.useRef)(null),[smoothScroll,setSmoothScroll]=(0,react.useState)();return(0,react.useEffect)((()=>{if(!containerRef.current)return;const instance=new SmoothScroll.X({container:containerRef.current});return setSmoothScroll(instance),instance.addPlugin(new SmoothScrollDragPlugin),()=>instance.destroy()}),[]),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>smoothScroll?.changeProps({isEnabled:!0}),children:"Enable"}),(0,jsx_runtime.jsx)("button",{type:"button",onClick:()=>smoothScroll?.changeProps({isEnabled:!1}),children:"Disable"}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("div",{ref:containerRef,className:"v-smooth-scroll",style:{height:500,maxWidth:500,backgroundColor:"#ccc"},children:(0,jsx_runtime.jsxs)("div",{className:"v-smooth-scroll__wrapper",children:[(0,jsx_runtime.jsx)("button",{type:"button",children:"Test button"}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("input",{type:"text",placeholder:"Test input"}),(0,times.D)((index=>(0,jsx_runtime.jsxs)("div",{children:["Lorem ipsum dolor sit amet",(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("br",{}),(0,jsx_runtime.jsx)("button",{type:"button",children:"Test button"})]},index)),40),(0,jsx_runtime.jsx)("button",{type:"button",children:"Test button"})]})})]})};Component.displayName="Component";try{Component.displayName="Component",Component.__docgenInfo={description:"",displayName:"Component",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/components/SmoothScrollDragPlugin/stories/index.tsx#Component"]={docgenInfo:Component.__docgenInfo,name:"Component",path:"src/components/SmoothScrollDragPlugin/stories/index.tsx#Component"})}catch(__react_docgen_typescript_loader_error){}const index_stories={title:"Components/SmoothScrollDragPlugin",component:Component},Default={};Default.parameters={...Default.parameters,docs:{...Default.parameters?.docs,source:{originalSource:"{}",...Default.parameters?.docs?.source}}};const __namedExportsOrder=["Default"]},"./src/base/Plugin/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>Plugin});var _Module__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/base/Module/index.ts");class Plugin extends _Module__WEBPACK_IMPORTED_MODULE_0__.Y{constructor(initialProps){super(initialProps,!1)}get component(){return this._component}set component(value){this._component=value}init(){if(!this.component)throw new Error("Component is unknown. Be sure that `plugin.component` is non-nullable.");super.init()}}},"./src/components/DraggerBase/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{S:()=>DraggerBase});var vevet_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/vevet-dom/dist/es/selectOne.js"),vevet_dom__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/vevet-dom/dist/es/isElement.js"),vevet_dom__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/vevet-dom/dist/es/isWindow.js"),vevet_dom__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/vevet-dom/dist/es/listeners.js"),_base_Component__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/base/Component/index.ts");class DraggerBase extends _base_Component__WEBPACK_IMPORTED_MODULE_0__.w{_getDefaultProps(){return{...super._getDefaultProps(),container:`#${this.prefix}`,isPassive:!1,isEnabled:!0}}get prefix(){return`${this.app.prefix}dragger`}get container(){return this._container}get isDragging(){return this._runtimeListeners.length>0}get pointerID(){return this._pointerID}get coords(){return this._coords}set coords(value){this._coords=value}get prevCoords(){return this._prevCoords}set prevCoords(value){this._prevCoords=value}get startCoords(){return this._startCoords}get type(){return this._type}constructor(initialProps,canInit=!0){if(super(initialProps,!1),this._container=(0,vevet_dom__WEBPACK_IMPORTED_MODULE_1__.z)(this.props.container),!(0,vevet_dom__WEBPACK_IMPORTED_MODULE_2__.k)(this._container)&&!(0,vevet_dom__WEBPACK_IMPORTED_MODULE_3__.F)(this._container))throw new Error("No container");this._runtimeListeners=[],this._pointerID=null,this._coords={x:0,y:0},this._prevCoords={x:0,y:0},this._startCoords={x:0,y:0},canInit&&this.init()}_init(){super._init(),this._setEvents()}_setEvents(){this.addEventListener(this.container,"mousedown",(event=>this._handleStart(event)),{passive:this.props.isPassive}),this.addEventListener(this.container,"touchstart",(event=>this._handleStart(event)),{passive:this.props.isPassive})}_addRuntimeEvents(){const{isPassive}=this.props;this._runtimeListeners.push((0,vevet_dom__WEBPACK_IMPORTED_MODULE_4__.O)(window,"mouseup",(event=>this.handleEnd(event)),{passive:isPassive})),this._runtimeListeners.push((0,vevet_dom__WEBPACK_IMPORTED_MODULE_4__.O)(window,"touchend",(event=>this.handleEnd(event)),{passive:isPassive})),this._runtimeListeners.push((0,vevet_dom__WEBPACK_IMPORTED_MODULE_4__.O)(window,"touchcancel",(()=>this.cancel()),{passive:isPassive})),this._runtimeListeners.push((0,vevet_dom__WEBPACK_IMPORTED_MODULE_4__.O)(window,"blur",(()=>this.cancel()),{passive:isPassive}))}_removeRuntimeEvents(){this._runtimeListeners.forEach((listener=>listener.remove())),this._runtimeListeners=[]}_getEventCoords(event){if(event.type.includes("touch")){const evt=event,touch=evt.targetTouches[0]||evt.changedTouches[0];return{x:touch.clientX,y:touch.clientY,pointerId:touch.identifier}}const evt=event;return{x:evt.clientX,y:evt.clientY,pointerId:null}}_handleStart(event){if(!this.props.isEnabled||this.isDragging)return!1;if("touchstart"===event.type?this._type="touch":this._type="mouse","mousedown"===event.type){if(1!==event.which)return!1;event.stopPropagation()}const{x,y,pointerId}=this._getEventCoords(event);return this._coords={x,y},this._prevCoords={x,y},this._startCoords={x,y},this._pointerID=pointerId,this._addRuntimeEvents(),this.callbacks.tbt("start",{event,start:this.startCoords,coords:this.coords}),!0}handleEnd(event){this._handleEndTimeout||(this._handleEndTimeout=setTimeout((()=>{const{pointerId}=this._getEventCoords(event);this.isDragging&&pointerId===this.pointerID&&(this._handleEnd(event),this._handleEndTimeout=void 0)}),1))}_handleEnd(event){this.cancel()}cancel(){this._removeRuntimeEvents(),this.callbacks.tbt("end",void 0)}_destroy(){this.cancel(),super._destroy(),this._removeRuntimeEvents(),this._handleEndTimeout&&clearTimeout(this._handleEndTimeout)}}},"./src/components/DraggerMove/index.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{J:()=>DraggerMove});var vevet_dom__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/vevet-dom/dist/es/listeners.js"),_DraggerBase__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./src/components/DraggerBase/index.ts");class DraggerMove extends _DraggerBase__WEBPACK_IMPORTED_MODULE_0__.S{_getDefaultProps(){return{...super._getDefaultProps(),disablePointerEventsAt:!1}}get stepCoords(){return{x:this.coords.x-this.prevCoords.x,y:this.coords.y-this.prevCoords.y}}get diffCoords(){return{x:this.coords.x-this.startCoords.x,y:this.coords.y-this.startCoords.y}}_addRuntimeEvents(){super._addRuntimeEvents();const{isPassive}=this.props;this._runtimeListeners.push((0,vevet_dom__WEBPACK_IMPORTED_MODULE_1__.O)(window,"mousemove",(event=>{"mouse"===this.type&&this._handleMove(event)}),{passive:isPassive})),this._runtimeListeners.push((0,vevet_dom__WEBPACK_IMPORTED_MODULE_1__.O)(window,"touchmove",(event=>{"touch"===this.type&&this._handleMove(event)}),{passive:isPassive}))}_handleMove(event){const{x,y,pointerId}=this._getEventCoords(event);return!(!this.isDragging||pointerId!==this.pointerID)&&(this.prevCoords={x:this.coords.x,y:this.coords.y},this.coords={x,y},this._togglePointerEvents(!1),this.callbacks.tbt("move",{event,start:this.startCoords,coords:this.coords,step:this.stepCoords,diff:this.diffCoords}),!0)}_handleEnd(event){super._handleEnd(event),this._togglePointerEvents(!0)}_togglePointerEvents(isEnabledProp){if("number"!=typeof this.props.disablePointerEventsAt)return;if(!(this.container instanceof HTMLElement))return;const isEnabled=Math.abs(this.diffCoords.x)<this.props.disablePointerEventsAt&&Math.abs(this.diffCoords.y)<this.props.disablePointerEventsAt||isEnabledProp;this.container.style.pointerEvents=isEnabled?"":"none"}_destroy(){super._destroy()}}},"./src/utils/common/times.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function times(callback,count){let index=0;const list=[];for(;index<count;)list.push(callback(index,count)),index+=1;return list}__webpack_require__.d(__webpack_exports__,{D:()=>times})}}]);